<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Batch-corrected imputation using magicBatch • magicBatch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Batch-corrected imputation using magicBatch">
<meta property="og:description" content="magicBatch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">magicBatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/batch_correction.html">Batch-corrected imputation using magicBatch</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Batch-corrected imputation using magicBatch</h1>
                        <h4 data-toc-skip class="author">Kevin
Brulois</h4>
            
            <h4 data-toc-skip class="date">2024-05-29</h4>
      
      
      <div class="hidden name"><code>batch_correction.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Marcov Affinity-based Graph Imputation of Cells (MAGIC) is an
algorithm described by <a href="https://www.cell.com/cell/fulltext/S0092-8674(18)30724-4" class="external-link">David
Van Dijk, et al</a> that denoises high-dimensional data by smoothing
over the manifold of the data and restoring the overall structure of the
data. It has been extensively applied to single-cell RNA sequencing data
where noise and dropout are a common problem.</p>
<p>Current implementations of MAGIC are well-suited for per batch
analyses, such as imputation of gene expression values. However, for
applications such as dimensional reduction of multi-batch datasets,
there is a need for cross-batch imputation that is responsive to batch
correction and other types of data correction methods (e.g. removal of
cell cycle effects).</p>
<p>magicBatch is a modified version of the MAGIC algorithm that allows
independent specification of the data used to compute the diffusion
operator and the data to be imputed. This enables any low-dimensional
representation of the data, including batch-corrected data, to be
directly used in the powered Marcov affinity matrix computation and
subsequently applied to the original gene expression data.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>First install the magicBatch python package from within R by
specifying the python_path using one of the following:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">python_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"which python3"</span>, intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#or "path/to/venv/bin/python" or "/path/to/python3.x"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">python_path</span>, <span class="st">"-m pip install magicBatch"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next install the following R packages:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"kbrulois/magicBatch"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'hylasD/tSpace'</span>, build <span class="op">=</span> <span class="cn">TRUE</span>, build_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"--no-resave-data"</span>, <span class="st">"--no-manual"</span><span class="op">)</span>, force <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">magicBatch</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tSpace</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-demo-data">Load demo data<a class="anchor" aria-label="anchor" href="#load-demo-data"></a>
</h2>
<p>We will use a single cell experiment object containing data from our
<a href="https://www.nature.com/articles/s41467-020-17291-5" class="external-link">single cell
survey of mouse lymph node endothelial cells</a>. Here we load the
object and extract the color scheme:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">'https://stacks.stanford.edu/file/druid:cf352cg6610/PLN123_SCE.rds'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">subset_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">[[</span><span class="st">"color.scheme"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">[[</span><span class="st">"color.scheme.key"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="motivation-magic-imputation-enhances-tspace">Motivation: MAGIC imputation enhances tSpace<a class="anchor" aria-label="anchor" href="#motivation-magic-imputation-enhances-tspace"></a>
</h2>
<p>First, we will illustrate the effect of MAGIC on the tSpace algorithm
in the absence of batch effects. For this, we will use one of the three
samples in the dataset and compute MAGIC using the classic
implementation. For this, we use the magicBatch function with
mar_mat_input = NULL (the default), which behaves identically to the
original MAGIC algorithm.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce_PLN1</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span>,<span class="va">sce</span><span class="op">$</span><span class="va">sample</span> <span class="op">==</span> <span class="st">"PLN1"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">lc_PLN1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html" class="external-link">logcounts</a></span><span class="op">(</span><span class="va">sce_PLN1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MAGIC_PLN1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/magicBatch.html">magicBatch</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">lc_PLN1</span>, </span>
<span>                         t_param <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                         python_command <span class="op">=</span> <span class="va">python_path</span><span class="op">)</span></span></code></pre></div>
<p>Next, we compute <a href="https://doi.org/10.1016/j.isci.2020.100842" class="external-link">tSpace</a> using the
imputed data (top 1000 variable genes) or a PCA of the non-imputed data
for comparison. Results are visualized using the html_3dPlot
function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">[[</span><span class="st">"var.genes"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">tsp_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>`Without MAGIC` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">lc_PLN1</span><span class="op">[</span>,<span class="va">var_genes</span><span class="op">]</span><span class="op">)</span>, rank. <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">[[</span><span class="st">"rotation"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                       `With MAGIC` <span class="op">=</span> <span class="va">MAGIC_PLN1</span><span class="op">[[</span><span class="st">"imputed_data"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"t6"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">var_genes</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                  \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">tSpace</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tSpace/man/tSpace.html" class="external-link">tSpace</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, </span>
<span>                                      trajectories <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                                      D <span class="op">=</span> <span class="st">'pearson_correlation'</span>, </span>
<span>                                      core_no <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, </span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tsp_out</span><span class="op">)</span>, </span>
<span>                          \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">tsp_out</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"ts_file"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tsp_out</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"ts_file"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                             subsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">sce_PLN1</span><span class="op">)</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>                          <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">html_3dPlot</span><span class="op">(</span>coordinates <span class="op">=</span> <span class="va">to_plot</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,  </span>
<span>            color <span class="op">=</span> <span class="va">to_plot</span><span class="op">[</span>,<span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, </span>
<span>            discrete_colors_custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>subsets <span class="op">=</span> <span class="va">subset_colors</span><span class="op">)</span>,</span>
<span>            wrap <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>            include_all_var <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            selfcontained <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<!--html_preserve-->
<p><iframe src="/Users/kbrulois/R_projects/magicBatch/plot1.html" frameborder="0" scrolling="no" height="800" width="1200">
</iframe></p>
<!--html_preserve-->
<p>MAGIC prior to tSpace provides a clearer visual representation the
developmental branching structure.</p>
</div>
<div class="section level2">
<h2 id="magicbatch-provides-a-way-to-apply-batch-corrected-imputation-prior-to-tspace">magicBatch provides a way to apply batch-corrected imputation prior
to tSpace<a class="anchor" aria-label="anchor" href="#magicbatch-provides-a-way-to-apply-batch-corrected-imputation-prior-to-tspace"></a>
</h2>
<p>Now we will return to the full dataset containing 3 samples (PLN1,
PLN2 and PLN3) and demonstrate the use of magicBatch to perform
batch-corrected imputation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MAGIC_wo_correction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/magicBatch.html">magicBatch</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html" class="external-link">logcounts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                  t_param <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                                  python_command <span class="op">=</span> <span class="va">python_path</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MAGIC_w_correction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/magicBatch.html">magicBatch</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html" class="external-link">logcounts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                 mar_mat_input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html" class="external-link">reducedDim</a></span><span class="op">(</span><span class="va">sce</span>, <span class="st">"MNN_correction"</span><span class="op">)</span>,</span>
<span>                                 t_param <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                                 python_command <span class="op">=</span> <span class="va">python_path</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tsp_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>`Without batch correction` <span class="op">=</span> <span class="va">MAGIC_wo_correction</span><span class="op">[[</span><span class="st">"imputed_data"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"t6"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">var_genes</span><span class="op">]</span>,</span>
<span>                       `With batch correction` <span class="op">=</span> <span class="va">MAGIC_w_correction</span><span class="op">[[</span><span class="st">"imputed_data"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"t6"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">var_genes</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                  \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">tSpace</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tSpace/man/tSpace.html" class="external-link">tSpace</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, </span>
<span>                                      trajectories <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                                      D <span class="op">=</span> <span class="st">'pearson_correlation'</span>, </span>
<span>                                      core_no <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">to_plot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, </span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tsp_out</span><span class="op">)</span>, </span>
<span>                          \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">tsp_out</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"ts_file"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tsp_out</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"ts_file"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>                          <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">html_3dPlot</span><span class="op">(</span>coordinates <span class="op">=</span> <span class="va">to_plot2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,  </span>
<span>            color <span class="op">=</span> <span class="va">to_plot2</span><span class="op">[</span>,<span class="fl">4</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>, </span>
<span>            discrete_colors_custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>subsets <span class="op">=</span> <span class="va">subset_colors</span><span class="op">)</span>,</span>
<span>            wrap <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>            include_all_var <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            texts <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>            selfcontained <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<!--html_preserve-->
<p><iframe src="/Users/kbrulois/R_projects/magicBatch/plot2.html" frameborder="0" scrolling="no" height="800" width="1200">
</iframe></p>
<!--html_preserve-->
<p>Without batch correction (original MAGIC), the 3 samples are poorly
integrated, with PLN3 (the only sample derived from C57BL/6 mice) being
the further separated compared to PLN1 and PLN2 (two BALB/c samples).
magicBatch provides an effective way to apply batch corrected
imputation.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kevin Brulois.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
